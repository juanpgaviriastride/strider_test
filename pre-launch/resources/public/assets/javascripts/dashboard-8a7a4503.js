function bulkEmail(i){var e={};e.emails=i,console.log("anti forgery"),console.log("emails"+i),e["__anti-forgery-token"]=$("#__anti-forgery-token").val(),$.post("/invitation",e,function(){$("#modal-invitation").modal(),$("form#email-form input[type=text]").each(function(){$(this).val("")})})}function sendMails(){var i=$.map($("form#email-form input[type=text]"),function(i){return $(i).val()}).filter(function(i){return null!=i&&""!=i});bulkEmail(i)}CSVParser=function(i){return this.options={el:null,source:null,success:null,error:null},_.extend(this.options,i),this.$element=$(this.options.el),this.$element.change($.proxy(this.onChange,this)),this},CSVParser.prototype.onChange=function(){this.parse()},CSVParser.prototype.parse=function(){var i=this;this.$element.parse({config:{header:!1,error:function(e){i.options.error&&i.options.error(results),i.errors=e},complete:function(e){i.results=e,e.errors.length>0&&(i.errors=e.errors),i.options.success&&i.options.success(e)}},before:function(){},error:function(){},complete:function(){}})},GetEmails=function(i){return this.options={objects:i,emails:[]},this.previuos_email_index=[],_.bindAll(this,"findEmails","readItem","emailMatch"),this.findEmails(),this},GetEmails.prototype.findEmails=function(){return this.emails=_.filter(_.map(this.options.objects,this.readItem),this.emailMatch),this.emails},GetEmails.prototype.readItem=function(i){var e,t;if(void 0==this.email_index){if(t=_.findIndex(i,this.emailMatch),!(t>=0))return"";this.email_index=t}if(e=i[this.email_index],this.emailMatch(e))return e;e=void 0;for(var n=0;n<this.previuos_email_index;n++)if(this.emailMatch(i[this.previuos_email_index[n]])){e=i[this.previuos_email_index[n]];break}return e||(this.previuos_email_index.push(this.email_index),this.email_index=_.findIndex(i,this.emailMatch),e=i[this.email_index]),e},GetEmails.prototype.emailMatch=function(i){return re=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,re.test(i)},$(document).ready(function(){csv=new CSVParser({el:$("#csv-file"),success:function(i){emails=new GetEmails(i.data),console.log("EMAIL:",emails.emails),bulkEmail(emails.emails)},error:function(i){console.log(">>>>> SE TOSTO",i)}}),$('[data-role="send-invitations"]').click(function(){console.log("send invitationts"),sendMails()}),$.ajax({url:"/dashboard/network-detail",method:"get",dataType:"json",success:function(i){console.log("JSON:",i),invitations=new Backbone.Collection(i),invitations_view=new InvitationTable({collection:invitations})},error:function(){console.log("ERROR:",arguments)}})});